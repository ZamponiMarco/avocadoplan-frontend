<ion-header>
  <ion-toolbar class="head" color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="close()">
        <ion-icon name="close" size="large"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Create plan</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>

  <!--
  <form [formGroup]="createForm" (ngSubmit)="createPlan()"> 
      <ion-item>
        <ion-label position="floating">Title</ion-label>
        <ion-input type="text" formControlName="plan_title"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Plan description</ion-label>
        <ion-textarea formControlName="plan_description"></ion-textarea>
      </ion-item>
  </form> -->
  <form [formGroup]="planForm" (ngSubmit)="createPlan()">


    <ion-card class="generality">
      <ion-item>
        <ion-label position="floating">Title</ion-label>
        <ion-input type="text" formControlName="title"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Plan description</ion-label>
        <ion-textarea formControlName="description"></ion-textarea>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Drinks</ion-label>
        <ion-textarea formControlName="drinkDescription"></ion-textarea>
      </ion-item>
    </ion-card>

    <ion-card class="action">
      <ion-item (click)="addDay()">
        <ion-icon name="add-circle-outline" size=medium></ion-icon>
      </ion-item>
      <ion-item (click)="confirm()">
        <ion-icon name="checkmark-circle-outline" size=medium></ion-icon>
      </ion-item>
    </ion-card>

    <div formArrayName="days">
    <div *ngFor="let day of planForm.get('days')?.controls; let i = index">
      <div [formGroupName]="i">
          <ion-card class="day">
            <ion-item (click)="deleteDay(i)">
              <ion-icon name="close"></ion-icon>
            </ion-item>
          <ion-item>
            <!-- change type to ion-select -->
            <ion-input type="number" formControlName="weekDay" placeholder="Giorno della settimana"></ion-input>
          </ion-item>
          <ion-item>
            <ion-input type="number" formControlName="week" placeholder="Settimana n*"></ion-input>
        </ion-item>
        <div formArrayName="meals">
          <div *ngFor="let meal of day.get('meals').controls; let j = index">
            <div [formGroupName]="j">
              <button (click)="showMealOverlay(i, j)">{{meal.get('type').value}}</button>
              <button (click)="deleteMeal(day.controls.meals, i, j)">Delete</button>

              <!-- START OF MEAL OVERLAY -->
              <div class="mealOverlay" [hidden]="overlayHidden[i][j]">
                <ion-item (click)="hideMealOverlay(i, j)">
                  <ion-icon name="close"></ion-icon>
                </ion-item>
                <ion-item>
                  <ion-select formControlName="type" placeholder="Tipo di pasto" name="type">
                    <ion-select-option *ngFor="let type of mealTypes | enumToArray" value="{{type}}">{{mealTypes[type]}}</ion-select-option>
                  </ion-select>
                </ion-item>
                <div formArrayName="dishes">
                  <ion-item (click)="addDish(meal.controls.dishes)">
                    <ion-icon name="add-circle-outline" size=medium></ion-icon>
                  </ion-item>
                  <ion-card *ngFor="let dish of meal.get('dishes').controls; let k = index">
                    <ion-item (click)="deleteDish(meal.controls.dishes, k)">
                      <ion-icon name="close"></ion-icon>
                    </ion-item>
                    <div [formGroupName]="k">
                      <ion-input type="text" formControlName="name" placeholder="Nome piatto"></ion-input>
                      <ion-input type="text" formControlName="description" placeholder="Descrizione piatto"></ion-input>
                    </div>
                  </ion-card>
                </div> <!-- formArrayName="dishes" -->
              </div>
              <!-- END OF MEAL OVERLAY -->
            </div> <!-- [formGroupName]="j" -->
          </div>
          <ion-item (click)="addMeal(day.controls.meals, i)">
            <ion-icon name="add-circle-outline" size=medium></ion-icon>
          </ion-item>
        </div>
      </ion-card>
      </div>
    </div>
    </div>

  </form>

</ion-content>


